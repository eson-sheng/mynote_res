<!DOCTYPE html>
<html><head><meta http-equiv='Content-Type' content='text/html; charset=utf8'><title>zentao sum</title><script src='res/util.js'></script><link rel='stylesheet' type='text/css' href='res/common.css'><style>.s0{color:#0000ff;}
.s1{color:#000000;}
.s2{color:#000000;}
.s3{color:#000000;}
.s4{color:#c80000;}
.s5{color:#0000ff;}
.s6{color:#000000;}
.s7{color:#c80000;}
.s8{color:#000080;}
.s9{color:#000000;}
.s10{color:#660000;}
.s11{color:#008000;}
.s12{color:#660e7a;}
.s13{color:#0000ff;}
</style></head><body>
<div id='outline'>
<li><a href='#ol_0' style='font-weight:bold; font-size:22px'>zentao sum</a></li>
<li> <a href='#ol_1' >使用phpstorm调试zentao</a></li>
<li> <a href='#ol_2' >zentao configs</a></li>
<li> <a href='#ol_3' >禅道bug优先级/系统浏览器配置</a></li>
<li> <a href='#ol_4' >zentao 数据库 dao</a></li>
<li> <a href='#ol_5' >zentao services</a></li>
<li> <a href='#ol_6' >zentao rewrite &amp; route</a></li>
<li> <a href='#ol_7' >zentao msyql ana</a></li>
<li> <a href='#ol_8' >禅道 zentao</a></li>
<li>  <a href='#ol_9' >浏览器复制图片并上传</a></li>
</div>

<t id='0d2536ee-35e0-4e9f-8156-9c40f98471bb'>
<pre><d class='s0'><br/><font size=8>zentao sum</font>
</d><d class='s0'></d></pre>
<pre><d class='s1'>zentao sum</d></pre>
<pre><d class='s1'></d></pre>
<pre><d class='s1'>D:\zentao\xampp</d></pre>
<pre><d class='s1'></d></pre>
<pre><d class='s1'><a href='zentao.html#cb7f62c1-672b-4502-8ba8-0a4506bffddd'>禅道 </a></d></pre>
<pre><d class='s1'><a href='todo.html#e8e66e69-b36a-43a6-a897-081afd173467'>database_op </a></d></pre>
<pre><d class='s2'><a href='xampp.html#7677ff9f-36d1-4159-b4d7-66fa9a9ec363'>XAMPP </a>从它简化而来？支持phpstorm调试</d><d class='s1'></d></pre>
<pre><d class='s1'><a href='apache.html#09f2ad75-a783-40b2-b491-4b54f5dbe338'>apache sum </a></d></pre>
<pre><d class='s3'></d></pre>
<pre><d class='s4'>7.2.5数据升级到8.1.3失败。因此还是沿用老版本的代码。</d></pre>
<pre><d class='s1'></d></pre>
<pre><d class='s1'>使用开源版本:</d></pre>
<pre><d class='s1'><a href='http://127.0.0.1:88/zentao/my/'>http://127.0.0.1:88/zentao/my/</a></d></pre>
<pre><d class='s1'>admin 123456</d></pre>
<pre><d class='s1'></d></pre>
<pre><d class='s1'><img src='pic\a62e2b956a66f47a7a6e5e1438732cb7.jpg' /></d><d class='s1'></d></pre>
<pre><d class='s1'></d></pre>
<pre><d class='s1'>这个脚本有问题</d></pre>
<pre><d class='s1'>mysql_installservice.bat</d></pre>
<pre><d class='s1'></d></pre>
<t id='190e3d5d-f809-41b8-b975-6d8d9fc30a5a'>
<pre><d class='s0'></d><d class='s0'></d></pre>
<pre><d class='s5'><h1 id='ol_1'>使用phpstorm调试zentao</h1>
<a href='sqlite_locate_failed!'>phpstorm debugging 2; 调试 分析 </a></d><d class='s1'></d></pre>
<pre><d class='s1'>zentao自带的php不支持调试（没有仔细研究）。</d><d class='s6'>将带调试支持的php版本（注意必须包含php5apache*.dll）替换zetao自带的，配置好xdebug（在phpinfo()中查看是否正常）即可支持调试。</d><d class='s1'></d></pre>
</t>
<pre><d class='s0'></d><d class='s1'></d></pre>
<pre><d class='s5'><h1 id='ol_2'>zentao configs</h1>
</d><d class='s7'></d></pre>
<pre><d class='s7'>注意最好不要用界面的修改端口的工具，不稳定！</d></pre>
<pre><d class='s5'></d></pre>
<pre><d class='s7'>apache port:</d><d class='s1'></d></pre>
<pre><d class='s1'>$root\apache\conf\httpd.conf -- 启动界面后，会自动修改$root\apache\conf\httpd.conf一些路径配置</d></pre>
<pre><d class='s1'># server basic settings.</d></pre>
<pre><d class='s1'>ServerRoot "D:/zentao/xampp/apache"</d></pre>
<pre><d class='s1'>DocumentRoot "D:/zentao/xampp/htdocs"</d></pre>
<pre><d class='s7'>Listen 88</d><d class='s1'></d></pre>
<pre><d class='s1'>ServerAdmin zentao@localhost.net</d></pre>
<pre><d class='s1'>ServerName </d><d class='s7'>localhost:88</d><d class='s1'></d></pre>
<pre><d class='s1'>PidFile "logs/httpd.pid"</d></pre>
<pre><d class='s1'></d></pre>
<pre><d class='s1'>php mysql连接：</d></pre>
<pre><d class='s1'>$root\zentao\config\config.php没有mysql的配置，在</d></pre>
<pre><d class='s1'>$root\zentao\config\my.php里面</d></pre>
<pre><d class='s8'>if</d><d class='s9'>(file_exists(</d><d class='s10'>$myConfig</d><d class='s9'>)) </d><d class='s8'>include </d><d class='s10'>$myConfig</d><d class='s9'>;</d></pre>
<pre><d class='s1'></d></pre>
<pre><d class='s1'>自带的mysql端口，注意不要使用集成界面的：</d></pre>
<pre><d class='s1'>$root\mysql\my.ini， [mysqld] 而非 [client]</d></pre>
<pre><d class='s1'></d></pre>
<pre><d class='s5'><h1 id='ol_3'>禅道bug优先级/系统浏览器配置</h1>
<a href='http://www.zentao.net/ask-view-2121.html'>http://www.zentao.net/ask-view-2121.html</a></d><d class='s1'></d></pre>
<pre><d class='s1'>都可以，后台bug优先级  自定义  如</d></pre>
<pre><d class='s1'>3-低</d></pre>
<pre><d class='s1'>1-紧急</d></pre>
<pre><d class='s1'>2-高</d></pre>
<pre><d class='s1'>4-较低</d></pre>
<pre><d class='s1'></d></pre>
<pre><d class='s5'><h1 id='ol_4'>zentao 数据库 dao</h1>
</d><d class='s7'>注意，必须使用自带的mysql，否则有问题。可以在自带的基础上进行备份、还原。</d></pre>
<pre><d class='s1'></d></pre>
<pre><d class='s1'>dao.class.php</d></pre>
<pre><d class='s8'>public function </d><d class='s9'>query(</d><d class='s10'>$sql </d><d class='s9'>= </d><d class='s11'>''</d><d class='s9'>)</d></pre>
<pre><d class='s1'></d></pre>
<pre><d class='s1'>$root\zentao\framework\router.class.php</d></pre>
<pre><d class='s1'>初始化global dbh（所有sql语句最终由他执行）：</d></pre>
<pre><d class='s8'>public function </d><d class='s9'>connectDB()</d></pre>
<pre><d class='s9'>{</d></pre>
<pre><d class='s9'>    </d><d class='s8'>global </d><d class='s10'>$config</d><d class='s9'>, </d><d class='s10'>$dbh</d><d class='s9'>, </d><d class='s10'>$slaveDBH</d><d class='s9'>;</d></pre>
<pre><d class='s9'>    </d><d class='s8'>if</d><d class='s9'>(!</d><d class='s8'>isset</d><d class='s9'>(</d><d class='s10'>$config</d><d class='s9'>-&gt;</d><d class='s12'>installed</d><d class='s9'>) </d><d class='s8'>or </d><d class='s9'>!</d><d class='s10'>$config</d><d class='s9'>-&gt;</d><d class='s12'>installed</d><d class='s9'>) </d><d class='s8'>return</d><d class='s9'>;</d></pre>
<pre><d class='s9'></d></pre>
<pre><d class='s9'>    </d><d class='s8'>if</d><d class='s9'>(</d><d class='s8'>isset</d><d class='s9'>(</d><d class='s10'>$config</d><d class='s9'>-&gt;</d><d class='s12'>db</d><d class='s9'>-&gt;</d><d class='s12'>host</d><d class='s9'>))      </d><d class='s10'>$this</d><d class='s9'>-&gt;</d><d class='s12'>dbh      </d><d class='s9'>= </d><d class='s10'>$dbh      </d><d class='s9'>= </d><d class='s10'>$this</d><d class='s9'>-&gt;connectByPDO(</d><d class='s10'>$config</d><d class='s9'>-&gt;</d><d class='s12'>db</d><d class='s9'>);</d></pre>
<pre><d class='s9'>    </d><d class='s8'>if</d><d class='s9'>(</d><d class='s8'>isset</d><d class='s9'>(</d><d class='s10'>$config</d><d class='s9'>-&gt;</d><d class='s12'>slaveDB</d><d class='s9'>-&gt;</d><d class='s12'>host</d><d class='s9'>)) </d><d class='s10'>$this</d><d class='s9'>-&gt;</d><d class='s12'>slaveDBH </d><d class='s9'>= </d><d class='s10'>$slaveDBH </d><d class='s9'>= </d><d class='s10'>$this</d><d class='s9'>-&gt;connectByPDO(</d><d class='s10'>$config</d><d class='s9'>-&gt;</d><d class='s12'>slaveDB</d><d class='s9'>);</d></pre>
<pre><d class='s9'>}</d></pre>
<pre><d class='s1'></d></pre>
<pre><d class='s8'>public function </d><d class='s9'>insert(</d><d class='s10'>$table</d><d class='s9'>)</d></pre>
<pre><d class='s8'>public function </d><d class='s9'>exec(</d><d class='s10'>$sql </d><d class='s9'>= </d><d class='s11'>''</d><d class='s9'>)</d></pre>
<pre><d class='s9'>CT_log(</d><d class='s11'>"---query string:"</d><d class='s9'>.</d><d class='s10'>$sql</d><d class='s9'>);</d></pre>
<pre><d class='s1'></d></pre>
<pre><d class='s12'>dbh</d><d class='s9'>-&gt;query</d><d class='s3'> 所有的都加log？</d></pre>
<pre><d class='s1'></d></pre>
<t id='977c5a5b-f3c6-4450-8f05-ba746d1e22d1'>
<pre><d class='s0'></d><d class='s0'></d></pre>
<pre><d class='s5'><h1 id='ol_5'>zentao services</h1>
<a href='sqlite_locate_failed!'>mysql 多实例; mysql service 服务 </a></d><d class='s1'></d></pre>
<pre><d class='s1'>$root\services -- 服务启动、停止。服务名字加了zt：</d></pre>
<pre><d class='s1'>net start apachezt</d></pre>
<pre><d class='s1'>net start mysqlzt</d></pre>
</t>
<pre><d class='s0'></d><d class='s1'></d></pre>
<t id='e8f62e88-d094-4165-b267-933840ab3ab3'>
<pre><d class='s0'></d><d class='s0'></d></pre>
<pre><d class='s5'><h1 id='ol_6'>zentao rewrite & route</h1>
</d><d class='s1'>http://localhost:81/zentao/my/ 实际路径：$root\zentao\www\index.php，my作为参数传递；如果存在my dir，则解析到my/index.php</d></pre>
<pre><d class='s1'></d></pre>
<pre><d class='s1'>我url输入 http://localhost:81/zentao/my/ </d></pre>
<pre><d class='s1'>结果访问到了$root\zentao\www\index.php</d></pre>
<pre><d class='s1'>see <a href='apache.html#c879feac-eb8d-4d0c-b236-8f269ae549d2'>apache rewrite </a></d></pre>
<pre><d class='s1'></d></pre>
</t>
<pre><d class='s0'></d><d class='s1'></d></pre>
<pre><d class='s5'><h1 id='ol_7'>zentao msyql ana</h1>
</d><d class='s1'>INSERT INTO `zt_bug` SET `product` = '2',`module` = '0',`project` = '0',`openedBuild` = 'trunk',`assignedTo` = '',`title` = 'bug title',`steps` = '&lt;p&gt;[步骤]11&lt;/p&gt;\r\n&lt;p&gt;[结果]22&lt;/p&gt;\r\n&lt;p&gt;[期望]33&lt;/p&gt;',`task` = '0',`type` = 'codeerror',`severity` = '3',`os` = '',`browser` = '',`mailto` = '',`keywords` = '',`case` = '0',`caseVersion` = '0',`result` = '0',`testtask` = '0',`openedBy` = 'admin',`openedDate` = '2016-05-17 15:31:25',`story` = '0'</d></pre>
<pre><d class='s1'></d></pre>
<pre><d class='s1'>确认并指派：</d></pre>
<pre><d class='s1'>UPDATE `zt_bug` SET `assignedTo` = 'cyb1',`pri` = '0',`mailto` = '',`confirmed` = '1',`lastEditedBy` = 'admin',`lastEditedDate` = '2016-05-17 15:38:13' wHeRe id  = '1'</d></pre>
<pre><d class='s1'></d></pre>
<pre><d class='s1'>解决：</d></pre>
<pre><d class='s1'>UPDATE `zt_bug` SET `title` = 'bug title',`steps` = '&lt;p&gt;[步骤]11&lt;/p&gt;\r\n&lt;p&gt;[结果]22&lt;/p&gt;\r\n&lt;p&gt;[期望]33&lt;/p&gt;',`product` = '2',`module` = '0',`plan` = '0',`type` = 'codeerror',`severity` = '3',`pri` = '0',`</d><d class='s7'>status</d><d class='s1'>` = 'active',`assignedTo` = 'cyb1',`os` = '',`browser` = '',`keywords` = '',`mailto` = '',`project` = '0',`story` = '0',`task` = '0',`openedBuild` = 'trunk',`resolvedBy` = '',`resolvedDate` = '',`resolvedBuild` = '',`resolution` = '',`duplicateBug` = '0',`closedBy` = '',`closedDate` = '',`linkBug` = '',`case` = '0',`lastEditedBy` = 'admin',`lastEditedDate` = '2016-05-17 15:39:39' wHeRe id  = '1'</d></pre>
<pre><d class='s1'></d></pre>
<pre><d class='s1'>解决2：</d></pre>
<pre><d class='s1'>UPDATE `zt_bug` SET `resolution` = 'fixed',`duplicateBug` = '0',`resolvedBuild` = 'trunk',`resolvedDate` = '2016-05-17 15:41:59',`assignedTo` = 'admin',`resolvedBy` = 'admin',</d><d class='s7'>`status` = 'resolved',`</d><d class='s1'>confirmed` = '1',`assignedDate` = '2016-05-17 15:41:59',`lastEditedBy` = 'admin',`lastEditedDate` = '2016-05-17 15:41:59' wHeRe id  = '1'</d></pre>
<pre><d class='s1'></d></pre>
<pre><d class='s1'>close：</d></pre>
<pre><d class='s1'>UPDATE `zt_bug` SET `assignedTo` = 'closed',`assignedDate` = '2016-05-17 15:43:41',</d><d class='s7'>`status` = 'closed',`</d><d class='s1'>closedBy` = 'admin',`closedDate` = '2016-05-17 15:43:41',`lastEditedBy` = 'admin',`lastEditedDate` = '2016-05-17 15:43:41',`confirmed` = '1' wHeRe id  = '1'</d></pre>
<pre><d class='s1'></d></pre>
<pre><d class='s1'>建任务：</d></pre>
<pre><d class='s1'>INSERT INTO `zt_task` SET `module` = '0',`type` = 'devel',`assignedTo` = '',`name` = 'task name',`desc` = 'desc',`pri` = '0',`estimate` = '0',`estStarted` = '0000-00-00',`deadline` = '0000-00-00',`mailto` = '',`project` = '1',`left` = '0',`story` = '0',`status` = 'wait',`openedBy` = 'admin',`openedDate` = '2016-05-30 15:56:08'</d></pre>
<pre><d class='s1'></d></pre>
<t id='cb7f62c1-672b-4502-8ba8-0a4506bffddd'>
<pre><d class='s0'></d><d class='s0'></d></pre>
<pre><d class='s13'><h1 id='ol_8'>禅道 zentao</h1>
<h2 id='ol_9'>浏览器复制图片并上传</h2>
<a href='http://121.40.140.194:82/zentao/task-create-1--0.html'>http://121.40.140.194:82/zentao/task-create-1--0.html</a></d><d class='s9'></d></pre>
<pre><d class='s9'>                /* Paste in chrome.*/</d></pre>
<pre><d class='s9'>                /* Code reference from <a href='http://www.foliotek.com/devblog/copy-images-from-clipboard-in-javascript/'>http://www.foliotek.com/devblog/copy-images-from-clipboard-in-javascript/</a>. */</d></pre>
<pre><d class='s9'>                if(K.WEBKIT)</d></pre>
<pre><d class='s9'>                {</d></pre>
<pre><d class='s9'>                    $(doc.body).bind('paste', function(ev)</d></pre>
<pre><d class='s9'>                    {</d></pre>
<pre><d class='s9'>                        var $this    = $(this);</d></pre>
<pre><d class='s9'>                        var original = ev.originalEvent;</d></pre>
<pre><d class='s9'>                        var file     = original.clipboardData.items[0].getAsFile();</d></pre>
<pre><d class='s9'>                        if(file)</d></pre>
<pre><d class='s9'>                        {</d></pre>
<pre><d class='s9'>                            var reader = new FileReader();</d></pre>
<pre><d class='s9'>                            reader.onload = function(evt) </d></pre>
<pre><d class='s9'>                            {</d></pre>
<pre><d class='s9'>                                var result = evt.target.result; </d></pre>
<pre><d class='s9'>                                var result = evt.target.result;</d></pre>
<pre><d class='s9'>                                var arr    = result.split(",");</d></pre>
<pre><d class='s9'>                                var data   = arr[1]; // raw base64</d></pre>
<pre><d class='s9'>                                var contentType = arr[0].split(";")[0].split(":")[1];</d></pre>
<pre><d class='s9'></d></pre>
<pre><d class='s9'>                                html = '&lt;img src="' + result + '" alt="" /&gt;';</d></pre>
<pre><d class='s9'>                                $.post(createLink('file', 'ajaxPasteImage'), {editor: html}, function(data){cmd.inserthtml(data);});</d></pre>
<pre><d class='s9'>                            };</d></pre>
<pre><d class='s9'>                            reader.readAsDataURL(file);</d></pre>
<pre><d class='s9'>                        }</d></pre>
<pre><d class='s9'>                    });</d></pre>
<pre><d class='s9'>                }</d></pre>
<pre><d class='s1'></d></pre>
</t>
<pre><d class='s0'></d></pre>
</body></html>
